<?xml version="1.0" encoding="utf-8"?>
<s:View xmlns:fx="http://ns.adobe.com/mxml/2009" 
		xmlns:s="library://ns.adobe.com/flex/spark" title="{strTitle}" creationComplete="User_creationCompleteHandler(event)">
	<s:layout>
		<s:VerticalLayout/>
	</s:layout>
	<fx:Script>
		<![CDATA[
			import flash.net.navigateToURL;
			
			import mx.events.FlexEvent;
			
			import spark.globalization.StringTools;
			
			[Bindable]
			private var strTitle:String;
			
			[Bindable]
			private var _user:User = new User();
			
			[Bindable]
			private var arrUserApp:Array = new Array();
			
			protected function User_creationCompleteHandler(event:FlexEvent):void
			{
				PopoloInfo();
				txtusr_nome.setFocus();
			}
			
			protected function UpdateUser():void
			{
				if(txtusr_nome.text.length > 0 && txtusr_cogn.text.length > 0){
					if(txtusr_link.text.length > 0){
						if(txtusr_link.text.indexOf("http://") == -1 && txtusr_link.text.indexOf("https://") == -1){
							txtusr_link.text="http://"+txtusr_link.text;
						}
					}
					if(_user.callquery('update tabella_utenti '+
						'set usr_nome = "'+txtusr_nome.text+'",usr_cogn = "'+txtusr_cogn.text+'", usr_faco = "'+txtusr_faco.text+'", usr_link = "'+txtusr_link.text+'"'+
						' where usr_codi = '+arrUserApp[0].usr_codi,null)){
						PopoloInfo();
						lblUpdate.setStyle("color","#33FF33");
						lblUpdate.text="Aggiornamento Completato !";
					}else{
						lblUpdate.setStyle("color","#FF0000");
						lblUpdate.text="Errore nell'Aggiornamento dell'Utente !";
					}
				}else{
					lblUpdate.setStyle("color","#FF0000");
					lblUpdate.text="Attenzione Digitare Nome e Cognome del profilo !";
				}
			}
			
			protected function PopoloInfo():void{
				arrUserApp=_user.getinfo();
				strTitle="Profilo - "+arrUserApp[0].usr_nome + " " + arrUserApp[0].usr_cogn;
				
				txtusr_nome.text=arrUserApp[0].usr_nome;
				txtusr_cogn.text=arrUserApp[0].usr_cogn;
				txtusr_faco.text=arrUserApp[0].usr_faco != null ? arrUserApp[0].usr_faco : '';
				txtusr_link.text=arrUserApp[0].usr_link != null ? arrUserApp[0].usr_link : '';
			}
			
			
			
			protected function link_clickHandler(event:MouseEvent):void
			{
				if(txtusr_link.text.length > 0){
					navigateToURL(new URLRequest(txtusr_link.text),"_blank");
				}
			}
			
		]]>
	</fx:Script>
	<fx:Declarations>
		<!-- Place non-visual elements (e.g., services, value objects) here -->
	</fx:Declarations>
	
	<s:TextInput id="txtusr_nome" y="64" width="100%" height="50" fontSize="20" maxChars="100" prompt="Nome" tabIndex="1" />
	<s:TextInput id="txtusr_cogn" width="100%" height="50" fontSize="20" maxChars="100" prompt="Cognome" tabIndex="2" />
	<s:TextInput id="txtusr_faco" width="100%" height="50" fontSize="20" maxChars="100" prompt="Facoltà" tabIndex="3" />
	<s:HGroup width="100%">
		<s:TextInput id="txtusr_link" width="100%" height="50" fontSize="20" maxChars="100" prompt="Link facoltà" tabIndex="4" />
		<s:Image width="50" height="50" source="image/arrow1.png" click="link_clickHandler(event)" useHandCursor="true" buttonMode="true" tabEnabled="false"/>
	</s:HGroup>
	<s:HGroup width="100%" bottom="10" horizontalAlign="center" tabEnabled="false">
		<s:Button label="Aggiorna" click="UpdateUser()" fontSize="20" />
	</s:HGroup>
	<s:HGroup width="100%" bottom="10" horizontalAlign="center" tabEnabled="false">
		<s:Label id="lblUpdate" height="50" fontSize="17"/>
	</s:HGroup>
</s:View>
